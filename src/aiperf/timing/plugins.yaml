# SPDX-FileCopyrightText: Copyright (c) 2025-2026 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
# yaml-language-server: $schema=../plugin/schema/plugins.schema.json

schema_version: "1.0"

# =============================================================================
# Timing Strategies
# =============================================================================
# Timing strategies control request scheduling and credit issuance.
# Determines when requests are sent based on fixed schedules, request rates,
# or user-centric patterns. One-to-one mapping per benchmark phase.
# =============================================================================
timing_strategy:
  fixed_schedule:
    class: aiperf.timing.strategies.fixed_schedule:FixedScheduleStrategy
    description: |
      A mode where the TimingManager will send requests according to a fixed schedule.
      Requests are sent at exact timestamps defined in the dataset.
      Useful for trace replay or exact timing requirements.

  request_rate:
    class: aiperf.timing.strategies.request_rate:RequestRateStrategy
    description: |
      A mode where the TimingManager will send requests using a request rate generator based on various modes.
      Optionally, a max concurrency limit can be specified as well.

  user_centric_rate:
    class: aiperf.timing.strategies.user_centric_rate:UserCentricStrategy
    description: |
      A mode where each session acts as a separate user with gap = num_users / request_rate between turns.
      Users block on their previous turn (no interleaving within a user).
      Matches LMBenchmark behavior for KV cache benchmarking.

# =============================================================================
# Arrival Pattern (Interval Generators)
# =============================================================================
# Interval generators determine inter-arrival times for request rate strategy.
# One-to-one mapping: exactly one generator is selected based on arrival_pattern.
# =============================================================================
arrival_pattern:
  concurrency_burst:
    class: aiperf.timing.intervals:ConcurrencyBurstIntervalGenerator
    description: |
      Generate intervals as soon as possible, up to a max concurrency limit.
      Only allowed when a request rate is not specified.
      Useful for saturation/throughput testing.

  constant:
    class: aiperf.timing.intervals:ConstantIntervalGenerator
    description: |
      Generate intervals at a constant rate.
      Useful for controlled request rate testing.

  gamma:
    class: aiperf.timing.intervals:GammaIntervalGenerator
    description: |
      Generate intervals using a gamma distribution with tunable smoothness.
      Use --arrival-smoothness to control the shape parameter:
      - smoothness = 1.0: Equivalent to Poisson (exponential inter-arrivals)
      - smoothness < 1.0: More bursty/clustered arrivals
      - smoothness > 1.0: More regular/smooth arrivals

  poisson:
    class: aiperf.timing.intervals:PoissonIntervalGenerator
    description: |
      Generate intervals using a poisson process.
      Useful for realistic traffic patterns.

# =============================================================================
# Ramp (Ramp Strategies)
# =============================================================================
# Ramp strategies control how values are gradually transitioned over time.
# Used for ramping concurrency limits, request rates, and other numeric parameters.
# =============================================================================
ramp:
  exponential:
    class: aiperf.timing.ramping:ExponentialStrategy
    description: |
      Exponential ease-in ramp strategy. Starts slow and accelerates toward target,
      providing gradual warmup before full load.

  linear:
    class: aiperf.timing.ramping:LinearStrategy
    description: |
      Linear ramp strategy with configurable step size. Steps at evenly spaced intervals
      for predictable, uniform value transitions.

  poisson:
    class: aiperf.timing.ramping:PoissonStrategy
    description: |
      Poisson ramp strategy with exponentially-distributed intervals.
      Provides stochastic burstiness while guaranteeing completion within duration.
